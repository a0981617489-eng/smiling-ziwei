<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¬‘ç‡ç‡ç´«å¾®æ–—æ•¸ - äººé¡ä¸–ç•Œæ”»ç•¥å°é­”æ³•</title>
    <!-- å¼•å…¥ç©©å®š CDN å‡½å¼åº« -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Silkscreen:wght@400;700&family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">

    <style>
        :root { --p-bg: #f7d7ff; --p-border: #4a1d96; --p-pink: #ec4899; }
        body { font-family: 'Silkscreen', "Noto Sans TC", sans-serif; background-color: var(--p-bg); color: #1e293b; margin: 0; overflow-x: hidden; }
        .pixel-card { border: 4px solid var(--p-border); box-shadow: 6px 6px 0px 0px var(--p-border); background: white; }
        .pixel-btn { border: 4px solid #000; box-shadow: 4px 4px 0px 0px #000; transition: all 0.1s; cursor: pointer; display: inline-flex; align-items: center; justify-content: center; }
        .pixel-btn:active { box-shadow: 0px 0px 0px 0px #000; transform: translate(4px, 4px); }
        h1, h2 { font-family: 'Press Start 2P', cursive; line-height: 1.5; }
        .grid-bg { background-image: radial-gradient(#4a1d96 1.5px, transparent 1.5px); background-size: 30px 30px; }
        
        /* ğŸˆ åƒç´ è²“å’ªå‹•ç•«æ¨£å¼ */
        .cat-container {
            position: fixed;
            bottom: 20px;
            left: -100px;
            z-index: 100;
            animation: cat-run-across 15s linear infinite;
            pointer-events: none; /* è®“è²“å’ªä¸æœƒæ“‹ä½é»æ“Š */
        }

        @keyframes cat-run-across {
            0% { left: -50px; transform: scaleX(1); }
            45% { left: 100%; transform: scaleX(1); }
            50% { left: 100%; transform: scaleX(-1); }
            95% { left: -50px; transform: scaleX(-1); }
            100% { left: -50px; transform: scaleX(1); }
        }

        .cat-pixel {
            width: 32px;
            height: 32px;
            image-rendering: pixelated;
        }

        .leg-animation {
            animation: leg-move 0.2s steps(2) infinite;
        }

        @keyframes leg-move {
            from { transform: translateY(0); }
            to { transform: translateY(1px); }
        }

        .social-icon:hover { transform: translateY(-4px); color: var(--p-pink); }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- Firebase è¼‰å…¥ -->
    <script src="https://www.gstatic.com/firebasejs/10.4.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.4.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.4.0/firebase-firestore-compat.js"></script>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- âš™ï¸ Firebase é…ç½® ---
        const firebaseConfig = {
            apiKey: "AIzaSyB9HsfmW3iNinFZD85XxMW9Om6valo3Nf8",
            authDomain: "smiling-ziwei.firebaseapp.com",
            projectId: "smiling-ziwei",
            storageBucket: "smiling-ziwei.firebasestorage.app",
            messagingSenderId: "447037749434",
            appId: "1:447037749434:web:b3827105adac2ecfb22a83"
        };
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const appId = "smiling-ziwei-official";

        // åœ–æ¨™çµ„ä»¶
        const Icon = ({ name, size = 20, className = "" }) => {
            useEffect(() => { if(window.lucide) lucide.createIcons(); }, []);
            return <i data-lucide={name} style={{ width: size, height: size }} className={className}></i>;
        };

        // ğŸˆ è·‘è·‘è²“çµ„ä»¶ (ç´” SVG è£½ä½œ)
        const RunningCat = () => (
            <div className="cat-container">
                <svg className="cat-pixel" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                    {/* è²“å’ªèº«é«” */}
                    <rect x="4" y="6" width="8" height="6" fill="#4a1d96" />
                    {/* è²“å’ªé ­ */}
                    <rect x="10" y="3" width="5" height="5" fill="#4a1d96" />
                    {/* è²“å’ªè€³æœµ */}
                    <rect x="10" y="2" width="1" height="1" fill="#4a1d96" />
                    <rect x="14" y="2" width="1" height="1" fill="#4a1d96" />
                    {/* çœ¼ç› */}
                    <rect x="11" y="4" width="1" height="1" fill="white" />
                    <rect x="13" y="4" width="1" height="1" fill="white" />
                    {/* å°¾å·´ */}
                    <rect x="1" y="5" width="1" height="4" fill="#4a1d96" />
                    <rect x="2" y="8" width="2" height="1" fill="#4a1d96" />
                    {/* è…³ (å¸¶å‹•ç•«) */}
                    <g className="leg-animation">
                        <rect x="5" y="12" width="2" height="2" fill="#4a1d96" />
                        <rect x="10" y="12" width="2" height="2" fill="#4a1d96" />
                    </g>
                </svg>
            </div>
        );

        const App = () => {
            const [user, setUser] = useState(null);
            const [isAdmin, setIsAdmin] = useState(false);
            const [isAuth, setIsAuth] = useState(false);
            const [pass, setPass] = useState("");
            const [bookings, setBookings] = useState([]);
            const [loading, setLoading] = useState(false);
            const [success, setSuccess] = useState(false);
            
            const [form, setForm] = useState({ 
                nickname: '', gender: 'ç”·', birthDate: '', 
                birthTime: 'å­æ™‚ (23:00-01:00)', service: 'å‘½ç›¤è§£æ', notes: '' 
            });

            const LINE_ID = "@147twhth";
            const IG_ID = "smilingziwei";

            const services = [
                { title: "å‘½ç›¤è§£æ", price: "2,000", time: "60 åˆ†é˜", desc: "å®Œæ•´æ€§æ ¼ã€åå¹´å¤§é™ã€æµå¹´è¦åŠƒã€‚", icon: "user" },
                { title: "æµå¹´é‹å‹¢", price: "1,000", time: "30 åˆ†é˜", desc: "å¹´åº¦é‡é»èˆ‡æœˆä»½å‰å‡¶æŒæ¡ã€‚", icon: "calendar" },
                { title: "å–®é¡Œå•äº‹", price: "600", time: "30 åˆ†é˜", desc: "ç‰¹å®šé›£é¡Œç²¾æº–è§£ç­”ã€‚", icon: "help-circle" },
                { title: "ç´«å¾®ç‰Œå¡", price: "500", time: "15 åˆ†é˜", desc: "ç•¶ä¸‹æŠ‰æ“‡çš„å¿«é€Ÿå¼•å°ã€‚", icon: "dices" }
            ];

            useEffect(() => {
                auth.signInAnonymously().catch(e => console.error(e));
                return auth.onAuthStateChanged(u => setUser(u));
            }, []);

            useEffect(() => {
                if (!user || !isAdmin || !isAuth) return;
                const unsubscribe = db.collection('artifacts').doc(appId).collection('public').doc('data').collection('bookings')
                    .onSnapshot(s => {
                        const data = s.docs.map(d => ({ id: d.id, ...d.data() }));
                        setBookings(data.sort((a,b) => (b.createdAt?.seconds || 0) - (a.createdAt?.seconds || 0)));
                    });
                return () => unsubscribe();
            }, [user, isAdmin, isAuth]);

            const submit = async (e) => {
                e.preventDefault();
                setLoading(true);
                try {
                    await db.collection('artifacts').doc(appId).collection('public').doc('data').collection('bookings').add({
                        ...form, createdAt: firebase.firestore.FieldValue.serverTimestamp(), status: 'æœªè™•ç†'
                    });
                    setSuccess(true);
                    window.scrollTo(0, 0);
                } catch(e) { alert("ç™¼é€å¤±æ•—ï¼"); }
                setLoading(false);
            };

            return (
                <div className="min-h-screen">
                    <RunningCat /> {/* ğŸˆ é€™è£¡æ’å…¥å°è²“ */}
                    
                    <nav className="fixed top-0 w-full bg-[#f7d7ff] border-b-4 border-purple-900 z-50 p-4 flex justify-between items-center shadow-md">
                        <div className="flex items-center gap-2 font-bold text-purple-900">
                            <Icon name="sparkles" />
                            <span className="text-sm">SMILING ZIWEI</span>
                        </div>
                        <button onClick={() => setIsAdmin(!isAdmin)} className="text-[10px] underline font-bold">
                            {isAdmin ? 'HOME' : 'ADMIN'}
                        </button>
                    </nav>

                    <div className="pt-24 px-6 max-w-xl mx-auto grid-bg min-h-screen pb-24">
                        {isAdmin ? (
                            !isAuth ? (
                                <div className="pixel-card p-10 text-center bg-white mt-10">
                                    <Icon name="lock" size={40} className="mx-auto mb-6 text-purple-900" />
                                    <h2 className="text-[10px] font-bold mb-8">Admin Access</h2>
                                    <input type="password" placeholder="PASSWORD" className="w-full p-3 border-2 border-black text-center font-bold mb-6" onChange={e => setPass(e.target.value)} />
                                    <button onClick={() => pass === "8888" ? setIsAuth(true) : alert("å¯†ç¢¼éŒ¯èª¤ï¼")} className="pixel-btn w-full bg-purple-900 text-white p-4 font-bold">Unlock</button>
                                </div>
                            ) : (
                                <div className="space-y-4 animate-in fade-in">
                                    <div className="flex justify-between items-center border-b-4 border-purple-900 pb-4 uppercase font-bold text-[10px]">
                                        <h2>Bookings ({bookings.length})</h2>
                                        <button onClick={()=>setIsAuth(false)} className="bg-black text-white px-2 py-1">Logout</button>
                                    </div>
                                    {bookings.map(b => (
                                        <div key={b.id} className="pixel-card p-4 text-[10px] font-bold bg-white">
                                            <div className="flex justify-between mb-2">
                                                <span className="text-purple-900 uppercase">{b.nickname}</span>
                                                <span className="text-pink-600 border px-1 border-pink-200 bg-pink-50">{b.service}</span>
                                            </div>
                                            <p className="opacity-60">Birth: {b.birthDate} ({b.birthTime})</p>
                                            {b.notes && <p className="mt-2 text-slate-500 italic font-normal">"{b.notes}"</p>}
                                            <div className="mt-4 flex justify-end">
                                                <button onClick={() => confirm('ç¢ºå®šåˆªé™¤ï¼Ÿ') && db.collection('artifacts').doc(appId).collection('public').doc('data').collection('bookings').doc(b.id).delete()} className="text-red-500 underline uppercase">Del</button>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )
                        ) : (
                            <div className="space-y-8">
                                {/* Studio Intro */}
                                <div className="pixel-card p-8 text-center bg-white shadow-xl">
                                    <h1 className="text-lg md:text-xl text-purple-900 font-bold uppercase mb-4 tracking-tighter">ç¬‘ç‡ç‡ç´«å¾®æ–—æ•¸<br/><span className="text-pink-600 text-sm">äººé¡ä¸–ç•Œæ”»ç•¥å°é­”æ³•</span></h1>
                                    <p className="text-[11px] leading-relaxed mb-6 font-bold text-slate-600">
                                        ä¸è¬›å®¿å‘½ï¼Œåªæ•™ä½ æ‹¿å›äººç”Ÿä¸»å°æ¬Šã€‚<br/>ç‡è‘—çœ¼ä¹Ÿèƒ½å„ªé›…é€šé—œã€‚
                                    </p>
                                    <div className="flex justify-center gap-4">
                                        <button onClick={() => document.getElementById('booking-form').scrollIntoView({behavior: 'smooth'})} className="pixel-btn bg-pink-500 text-white px-4 py-2 text-[10px] font-bold">ç«‹åˆ»é ç´„</button>
                                        <button onClick={() => window.open(`https://line.me/R/ti/p/@147twhth`)} className="pixel-btn bg-white px-4 py-2 text-[10px] font-bold">LINE è«®è©¢</button>
                                    </div>
                                </div>

                                {/* Services */}
                                <div className="space-y-4">
                                    <h2 className="text-[10px] text-purple-900 font-bold border-b-4 border-purple-900 pb-1">SERVICES / æœå‹™é …ç›®</h2>
                                    {services.map((s, idx) => (
                                        <div key={idx} className="pixel-card p-5 bg-white">
                                            <div className="flex items-center gap-3 mb-2">
                                                <div className="w-10 h-10 bg-purple-100 flex items-center justify-center border-2 border-purple-900">
                                                    <Icon name={s.icon} className="text-purple-900" />
                                                </div>
                                                <div>
                                                    <h3 className="text-xs font-bold text-purple-900">{s.title}</h3>
                                                    <div className="flex gap-2 text-[9px] font-bold">
                                                        <span className="text-pink-600">NT$ {s.price}</span>
                                                        <span className="text-slate-400">({s.time})</span>
                                                    </div>
                                                </div>
                                            </div>
                                            <p className="text-[10px] text-slate-500 leading-relaxed font-bold">{s.desc}</p>
                                        </div>
                                    ))}
                                </div>

                                {/* Form */}
                                <div id="booking-form">
                                    {!success ? (
                                        <form onSubmit={submit} className="pixel-card p-6 space-y-6 bg-white shadow-lg">
                                            <div className="text-center border-b-2 border-dashed border-purple-100 pb-4 font-bold text-xs uppercase text-purple-900">Registration</div>
                                            <div className="space-y-5 text-[10px] font-bold uppercase">
                                                <input required placeholder="æš±ç¨± / NICKNAME" className="w-full p-4 border-2 border-black focus:bg-pink-50 outline-none font-bold" onChange={e => setForm({...form, nickname: e.target.value})} />
                                                <select className="w-full p-4 border-2 border-black bg-white outline-none font-bold" onChange={e => setForm({...form, service: e.target.value})}>
                                                    {services.map(s => <option key={s.title}>{s.title} ({s.time})</option>)}
                                                </select>
                                                <div className="grid grid-cols-2 gap-4">
                                                    <input required type="date" className="w-full p-4 border-2 border-black outline-none font-bold" onChange={e => setForm({...form, birthDate: e.target.value})} />
                                                    <select className="w-full p-4 border-2 border-black bg-white outline-none font-bold" onChange={e => setForm({...form, birthTime: e.target.value})}>
                                                        <option>å­æ™‚ (23-01)</option><option>ä¸‘æ™‚ (01-03)</option><option>å¯…æ™‚ (03-05)</option>
                                                        <option>å¯æ™‚ (05-07)</option><option>è¾°æ™‚ (07-09)</option><option>å·³æ™‚ (09-11)</option>
                                                        <option>åˆæ™‚ (11-13)</option><option>æœªæ™‚ (13-15)</option><option>ç”³æ™‚ (15-17)</option>
                                                        <option>é…‰æ™‚ (17-19)</option><option>æˆŒæ™‚ (19-21)</option><option>äº¥æ™‚ (21-23)</option>
                                                    </select>
                                                </div>
                                                <textarea placeholder="å‚™è¨» / NOTE" className="w-full p-4 border-2 border-black outline-none h-24 focus:bg-pink-50 resize-none font-bold" onChange={e => setForm({...form, notes: e.target.value})} />
                                            </div>
                                            <button type="submit" disabled={loading} className="pixel-btn w-full bg-pink-500 text-white p-5 font-bold shadow-lg text-xs uppercase tracking-widest">
                                                {loading ? 'Sending...' : 'Start Quest / ç¢ºèªé ç´„'}
                                            </button>
                                        </form>
                                    ) : (
                                        <div className="pixel-card p-12 text-center bg-white space-y-8 animate-in zoom-in-95">
                                            <Icon name="check-circle" size={64} className="mx-auto text-green-500" />
                                            <h2 className="text-lg text-purple-900 font-bold uppercase tracking-tighter">Mission Clear!</h2>
                                            <button onClick={() => window.open(`https://line.me/R/ti/p/@147twhth`)} className="pixel-btn bg-[#06c755] text-white p-5 w-full font-bold shadow-lg">å‰å¾€ LINE ç¢ºèª</button>
                                            <button onClick={() => setSuccess(false)} className="text-[10px] underline opacity-30 block mx-auto font-bold uppercase mt-4">Back</button>
                                        </div>
                                    )}
                                </div>
                            </div>
                        )}
                    </div>

                    {/* Footer with IG & LINE */}
                    <footer className="py-12 text-center bg-white border-t-4 border-purple-900">
                        <div className="flex justify-center gap-8 mb-6">
                            <a href={`https://instagram.com/${IG_ID}`} target="_blank" className="social-icon flex flex-col items-center gap-1">
                                <Icon name="instagram" size={28} />
                                <span className="text-[8px] font-bold">IG</span>
                            </a>
                            <a href={`https://line.me/R/ti/p/@147twhth`} target="_blank" className="social-icon flex flex-col items-center gap-1">
                                <Icon name="message-circle" size={28} />
                                <span className="text-[8px] font-bold">LINE</span>
                            </a>
                        </div>
                        <p className="opacity-30 text-[8px] font-bold">Â© 2026 SMILING ZIWEI STUDIO</p>
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>

