<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç¬‘ç‡ç‡ç´«å¾®æ–—æ•¸ - äººé¡ä¸–ç•Œæ”»ç•¥å°é­”æ³•</title>
    
    <!-- æ ¸å¿ƒ CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Silkscreen:wght@400;700&family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
    
    <!-- Firebase æ ¸å¿ƒ (è®€å–å¾Œå°ç”¨) -->
    <script src="https://www.gstatic.com/firebasejs/10.4.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.4.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.4.0/firebase-firestore-compat.js"></script>

    <style>
        :root { --p-bg: #f7d7ff; --p-border: #4a1d96; --p-pink: #ec4899; }
        body { font-family: 'Silkscreen', "Noto Sans TC", sans-serif; background-color: var(--p-bg); color: #1e293b; margin: 0; overflow-x: hidden; }
        .pixel-card { border: 4px solid var(--p-border); box-shadow: 6px 6px 0px 0px var(--p-border); background: white; }
        .pixel-btn { border: 4px solid #000; box-shadow: 4px 4px 0px 0px #000; transition: all 0.1s; cursor: pointer; display: inline-flex; align-items: center; justify-content: center; }
        .pixel-btn:active { box-shadow: 0px 0px 0px 0px #000; transform: translate(4px, 4px); }
        h1, h2 { font-family: 'Press Start 2P', cursive; line-height: 1.2; }
        .grid-bg { background-image: radial-gradient(#4a1d96 1.5px, transparent 1.5px); background-size: 30px 30px; }
        .cat-run { position: fixed; bottom: 35px; z-index: 100; animation: cat-across 12s linear infinite; pointer-events: none; }
        @keyframes cat-across { 0% { left: -50px; transform: scaleX(1); } 48% { transform: scaleX(1); } 50% { left: 100%; transform: scaleX(-1); } 98% { transform: scaleX(-1); } 100% { left: -50px; transform: scaleX(1); } }
        .leg-move { animation: legs 0.15s steps(2) infinite; }
        @keyframes legs { from { transform: translateY(0); } to { transform: translateY(2px); } }
        input, select, textarea { font-weight: bold; border-radius: 0; outline: none; border: 2px solid black; padding: 12px; width: 100%; background: white; }
        .hidden { display: none; }
        .service-tag { background: #fee2e2; color: #ef4444; border: 2px solid #ef4444; font-size: 10px; padding: 2px 6px; font-weight: bold; }
        #success-modal, #admin-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(74, 29, 150, 0.9); display: none; align-items: center; justify-content: center; z-index: 1000; padding: 20px; overflow-y: auto; }
    </style>
</head>
<body class="grid-bg min-h-screen">

    <!-- è·‘è·‘è²“ -->
    <div class="cat-run">
        <svg width="40" height="40" viewBox="0 0 16 16" fill="none"><rect x="4" y="6" width="8" height="6" fill="#4a1d96" /><rect x="10" y="3" width="5" height="5" fill="#4a1d96" /><rect x="10" y="2" width="1" height="1" fill="#4a1d96" /><rect x="14" y="2" width="1" height="1" fill="#4a1d96" /><rect x="11" y="4" width="1" height="1" fill="white" /><rect x="13" y="4" width="1" height="1" fill="white" /><rect x="1" y="5" width="1" height="4" fill="#4a1d96" /><g class="leg-move"><rect x="5" y="12" width="2" height="2" fill="#4a1d96" /><rect x="10" y="12" width="2" height="2" fill="#4a1d96" /></g></svg>
    </div>

    <!-- å°èˆªåˆ— -->
    <nav class="fixed top-0 w-full bg-[#f7d7ff] border-b-4 border-purple-900 z-50 p-4 flex justify-between items-center shadow-md">
        <div class="flex items-center gap-2 font-bold text-purple-900"><span>âœ¨</span><span class="text-sm font-bold uppercase">SMILING ZIWEI</span></div>
        <button onclick="openAdmin()" class="text-[10px] underline font-bold uppercase">Admin</button>
    </nav>

    <main id="main-content" class="pt-24 px-6 max-w-xl mx-auto pb-24 w-full">
        <!-- ä»‹ç´¹ -->
        <div class="pixel-card p-8 text-center mb-8 shadow-xl">
            <h1 class="text-lg md:text-xl text-purple-900 font-bold uppercase mb-4 tracking-tighter leading-tight">ç¬‘ç‡ç‡ç´«å¾®æ–—æ•¸<br/><span class="text-pink-600 text-sm">äººé¡ä¸–ç•Œæ”»ç•¥å°é­”æ³•</span></h1>
            <p class="text-[11px] leading-relaxed mb-6 font-bold text-slate-600 uppercase">æ‹¿å›äººç”Ÿä¸»å°æ¬Šï¼Œå„ªé›…é€šé—œäººé¡ä¸–ç•Œã€‚</p>
            <div class="flex justify-center gap-4">
                <a href="#booking-area" class="pixel-btn bg-pink-500 text-white px-4 py-2 text-[10px] font-bold shadow-lg">ç«‹åˆ»é ç´„</a>
                <a href="https://line.me/R/ti/p/@147twhth" target="_blank" class="pixel-btn bg-white px-4 py-2 text-[10px] font-bold text-purple-900">LINE è«®è©¢</a>
            </div>
        </div>

        <!-- æœå‹™ -->
        <div class="space-y-4 mb-8">
            <h2 class="text-[10px] text-purple-900 font-bold border-b-4 border-purple-900 pb-1 uppercase tracking-widest text-center">Services / è«®è©¢é …ç›®</h2>
            <div class="pixel-card p-5 bg-white mb-2"><div class="flex items-center gap-3"><div class="text-2xl">ğŸ‘¤</div><div class="flex-grow"><h3 class="text-xs font-bold text-purple-900">å‘½ç›¤è§£æ</h3><div class="text-[9px] font-bold text-pink-600 mt-1">NT$ 2,000 / 60min</div></div><span class="service-tag">HOT</span></div></div>
            <div class="pixel-card p-5 bg-white mb-2"><div class="flex items-center gap-3"><div class="text-2xl">ğŸ“…</div><div class="flex-grow"><h3 class="text-xs font-bold text-purple-900">æµå¹´é‹å‹¢</h3><div class="text-[9px] font-bold text-pink-600 mt-1">NT$ 1,000 / 30min</div></div></div></div>
            <div class="pixel-card p-5 bg-white mb-2"><div class="flex items-center gap-3"><div class="text-2xl">â“</div><div class="flex-grow"><h3 class="text-xs font-bold text-purple-900">å–®é¡Œå•äº‹</h3><div class="text-[9px] font-bold text-pink-600 mt-1">NT$ 600 / 30min</div></div></div></div>
            <div class="pixel-card p-5 bg-white mb-2"><div class="flex items-center gap-3"><div class="text-2xl">ğŸŒŒ</div><div class="flex-grow"><h3 class="text-xs font-bold text-purple-900">æ·±åº¦æ•´åˆ</h3><div class="text-[9px] font-bold text-pink-600 mt-1">NT$ 3,000 / 90min</div></div></div></div>
            <div class="pixel-card p-5 bg-white mb-2"><div class="flex items-center gap-3"><div class="text-2xl">ğŸƒ</div><div class="flex-grow"><h3 class="text-xs font-bold text-purple-900">ç´«å¾®ç‰Œå¡</h3><div class="text-[9px] font-bold text-pink-600 mt-1">NT$ 500 / 15min</div></div></div></div>
        </div>

        <!-- è¡¨å–® -->
        <div id="booking-area" class="pixel-card p-6 bg-white shadow-lg">
            <div class="text-center border-b-2 border-dashed border-purple-100 pb-4 font-bold text-xs uppercase text-purple-900 mb-6 tracking-widest">Registration / è§’è‰²ç™»éŒ„</div>
            <form id="booking-form" action="https://formspree.io/f/mimichen0130@icloud.com" method="POST" class="space-y-5 text-[10px] font-bold uppercase text-left">
                <input required name="ç¨±å‘¼" type="text" placeholder="æš±ç¨± / NICKNAME">
                <input required name="email" type="email" placeholder="ä¿¡ç®± / EMAIL">
                <select name="è«®è©¢é …ç›®"><option>å‘½ç›¤è§£æ</option><option>æµå¹´é‹å‹¢</option><option>å–®é¡Œå•äº‹</option><option>æ·±åº¦æ•´åˆ</option><option>ç´«å¾®ç‰Œå¡</option></select>
                <div class="grid grid-cols-2 gap-4">
                    <select name="æ€§åˆ¥"><option>å¥³</option><option>ç”·</option></select>
                    <select name="å‡ºç”Ÿæ™‚è¾°"><option>å­</option><option>ä¸‘</option><option>å¯…</option><option>å¯</option><option>è¾°</option><option>å·³</option><option>åˆ</option><option>æœª</option><option>ç”³</option><option>é…‰</option><option>æˆŒ</option><option>äº¥</option></select>
                </div>
                <input required name="åœ‹æ›†ç”Ÿæ—¥" type="date">
                <textarea name="å‚™è¨»" placeholder="é‡åˆ°çš„ç…©æƒ±..."></textarea>
                <button type="submit" id="submit-btn" class="pixel-btn w-full bg-pink-500 text-white p-5 font-bold shadow-lg text-xs uppercase">Confirm / é€å‡ºé ç´„</button>
            </form>
        </div>
    </main>

    <!-- æˆåŠŸå½ˆçª— -->
    <div id="success-modal">
        <div class="pixel-card p-8 text-center bg-white w-full max-w-sm shadow-2xl space-y-6">
            <div class="text-5xl">ğŸ’Œ</div>
            <h2 class="text-lg text-purple-900 font-bold uppercase tracking-tighter">Mission Clear!</h2>
            <p class="text-[11px] font-bold text-slate-500 leading-relaxed uppercase">é ç´„è³‡æ–™å·²æˆåŠŸå¯„é€ï¼<br>è«‹é»æ“Šä¸‹æ–¹æŒ‰éˆ•å‘ŠçŸ¥è€å¸«ã€‚</p>
            <a href="https://line.me/R/ti/p/@147twhth" target="_blank" class="pixel-btn bg-[#06c755] text-white p-4 w-full font-bold text-[10px] uppercase shadow-lg block">å‰å¾€ LINE ç¢ºèª</a>
            <button onclick="closeModals()" class="text-[10px] underline opacity-30 block mx-auto font-bold uppercase">Close</button>
        </div>
    </div>

    <!-- å¾Œå°å½ˆçª— -->
    <div id="admin-modal">
        <!-- ç™»å…¥ä»‹é¢ -->
        <div id="admin-login-ui" class="pixel-card p-8 text-center bg-white w-full max-w-sm shadow-2xl space-y-6">
            <h2 class="text-lg text-purple-900 font-bold uppercase">Admin Login</h2>
            <input type="password" id="admin-pass" placeholder="PASSWORD" class="text-center font-bold">
            <button onclick="loginAdmin()" class="pixel-btn w-full bg-purple-900 text-white p-4 font-bold text-xs uppercase shadow-lg">Login</button>
            <button onclick="closeModals()" class="text-[10px] underline opacity-30 block mx-auto font-bold uppercase">Cancel</button>
        </div>
        <!-- åˆ—è¡¨ä»‹é¢ -->
        <div id="admin-dashboard-ui" class="hidden pixel-card p-6 bg-white w-full max-w-xl shadow-2xl space-y-4 max-h-[80vh] overflow-y-auto">
            <div class="flex justify-between items-center border-b-4 border-purple-900 pb-2">
                <h2 class="text-xs font-bold text-purple-900 uppercase">Records</h2>
                <button onclick="closeModals()" class="bg-black text-white px-2 py-1 text-[8px] font-bold">EXIT</button>
            </div>
            <div id="records-list" class="space-y-4">
                <p class="text-center py-10 opacity-30 font-bold">LOADING DATA...</p>
            </div>
        </div>
    </div>

    <footer class="py-12 text-center bg-white border-t-4 border-purple-900 mt-auto">
        <div class="flex justify-center gap-10 mb-8">
            <a href="https://www.instagram.com/mimichen0130/" target="_blank" class="flex flex-col items-center gap-2"><div class="w-12 h-12 border-4 border-purple-900 flex items-center justify-center bg-white text-2xl">ğŸ“¸</div><span class="text-[8px] font-bold tracking-widest uppercase">IG</span></a>
            <a href="https://line.me/R/ti/p/@147twhth" target="_blank" class="flex flex-col items-center gap-2"><div class="w-12 h-12 border-4 border-purple-900 flex items-center justify-center bg-white text-2xl">ğŸ’¬</div><span class="text-[8px] font-bold tracking-widest uppercase">LINE</span></a>
        </div>
        <p class="opacity-30 text-[8px] font-bold uppercase">Â© 2026 SMILING ZIWEI STUDIO</p>
    </footer>

    <script>
        // Firebase è¨­å®š
        const fbConfig = { apiKey: "AIzaSyB9HsfmW3iNinFZD85XxMW9Om6valo3Nf8", authDomain: "smiling-ziwei.firebaseapp.com", projectId: "smiling-ziwei", storageBucket: "smiling-ziwei.firebasestorage.app", messagingSenderId: "447037749434", appId: "1:447037749434:web:b3827105adac2ecfb22a83" };
        firebase.initializeApp(fbConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();
        const appId = "smiling-ziwei-official";

        // è¡¨å–®æäº¤
        document.getElementById('booking-form').onsubmit = async function(e) {
            e.preventDefault();
            const btn = document.getElementById('submit-btn');
            btn.disabled = true; btn.innerText = "SENDING...";
            
            // 1. åŒæ­¥å‚™ä»½åˆ°è³‡æ–™åº« (å¾Œå°æ‰çœ‹å¾—åˆ°)
            const formData = new FormData(this);
            const dataObj = {}; formData.forEach((v,k)=>dataObj[k]=v);
            try {
                await auth.signInAnonymously();
                await db.collection('artifacts').doc(appId).collection('public').doc('data').collection('bookings').add({
                    ...dataObj, createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                // 2. å¯„ä¿¡é€šçŸ¥è€å¸«
                await fetch(this.action, { method: 'POST', body: formData, headers: { 'Accept': 'application/json' }});
                document.getElementById('success-modal').style.display = 'flex';
                this.reset();
            } catch(err) { alert("ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹ç›´æ¥è¯ç¹«è€å¸«ï¼"); }
            btn.disabled = false; btn.innerText = "Confirm / é€å‡ºé ç´„";
        };

        // å¾Œå°ç™»å…¥
        function openAdmin() { document.getElementById('admin-modal').style.display = 'flex'; }
        function closeModals() { document.querySelectorAll('#success-modal, #admin-modal').forEach(m=>m.style.display='none'); }

        function loginAdmin() {
            if(document.getElementById('admin-pass').value === "8888") {
                document.getElementById('admin-login-ui').classList.add('hidden');
                document.getElementById('admin-dashboard-ui').classList.remove('hidden');
                fetchRecords();
            } else { alert("å¯†ç¢¼éŒ¯èª¤ï¼"); }
        }

        async function fetchRecords() {
            const list = document.getElementById('records-list');
            try {
                const snapshot = await db.collection('artifacts').doc(appId).collection('public').doc('data').collection('bookings').orderBy('createdAt','desc').get();
                list.innerHTML = "";
                if(snapshot.empty) { list.innerHTML = "<p class='text-center py-10 opacity-30'>NO RECORDS FOUND</p>"; return; }
                snapshot.forEach(doc => {
                    const b = doc.data();
                    const card = document.createElement('div');
                    card.className = "pixel-card p-4 text-[10px] font-bold bg-white border-2 border-black";
                    card.innerHTML = `
                        <div class="flex justify-between border-b pb-2 mb-2 text-purple-900">
                            <span>${b.ç¨±å‘¼} (${b.æ€§åˆ¥})</span>
                            <span class="text-pink-600">${b.è«®è©¢é …ç›®}</span>
                        </div>
                        <div class="opacity-70">
                            <p>ç”Ÿæ—¥ï¼š${b.åœ‹æ›†ç”Ÿæ—¥} (${b.å‡ºç”Ÿæ™‚è¾°}æ™‚)</p>
                            <p class="mt-2 text-slate-500 italic">å‚™è¨»ï¼š${b.å‚™è¨» || 'ç„¡'}</p>
                        </div>
                        <button onclick="deleteRec('${doc.id}')" class="mt-3 text-red-500 underline uppercase text-[8px] block ml-auto">Delete</button>
                    `;
                    list.appendChild(card);
                });
            } catch(e) { list.innerHTML = "<p class='text-center text-red-500 font-bold'>ERROR LOADING DATA</p>"; }
        }

        async function deleteRec(id) {
            if(confirm("ç¢ºå®šåˆªé™¤æ­¤ç´€éŒ„ï¼Ÿ")) {
                await db.collection('artifacts').doc(appId).collection('public').doc('data').collection('bookings').doc(id).delete();
                fetchRecords();
            }
        }
    </script>
</body>
</html>

