<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¬‘ç‡ç‡ç´«å¾®æ–—æ•¸ - äººé¡ä¸–ç•Œæ”»ç•¥å°é­”æ³•</title>
    <!-- å¼•å…¥ React, Babel, Tailwind èˆ‡ Lucide åœ–æ¨™ -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Silkscreen:wght@400;700&family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">

    <!-- Firebase å‚³çµ±ç‰ˆ SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.4.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.4.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.4.0/firebase-firestore-compat.js"></script>

    <style>
        :root { --p-bg: #f7d7ff; --p-border: #4a1d96; --p-pink: #ec4899; }
        body { font-family: 'Silkscreen', "Noto Sans TC", sans-serif; background-color: var(--p-bg); color: #1e293b; margin: 0; overflow-x: hidden; }
        .pixel-card { border: 4px solid var(--p-border); box-shadow: 6px 6px 0px 0px var(--p-border); background: white; }
        .pixel-btn { border: 4px solid #000; box-shadow: 4px 4px 0px 0px #000; transition: all 0.1s; cursor: pointer; display: inline-flex; align-items: center; justify-content: center; }
        .pixel-btn:active { box-shadow: 0px 0px 0px 0px #000; transform: translate(4px, 4px); }
        h1, h2 { font-family: 'Press Start 2P', cursive; line-height: 1.5; }
        .grid-bg { background-image: radial-gradient(#4a1d96 1.5px, transparent 1.5px); background-size: 30px 30px; }
        
        /* ğŸˆ è·‘è·‘è²“å‹•ç•« */
        .cat-run {
            position: fixed;
            bottom: 35px;
            z-index: 100;
            animation: cat-across 12s linear infinite;
            pointer-events: none;
        }
        @keyframes cat-across {
            0% { left: -50px; transform: scaleX(1); }
            48% { transform: scaleX(1); }
            50% { left: 100%; transform: scaleX(-1); }
            98% { transform: scaleX(-1); }
            100% { left: -50px; transform: scaleX(1); }
        }
        .leg-move { animation: legs 0.1s steps(2) infinite; }
        @keyframes legs { from { transform: translateY(0); } to { transform: translateY(2px); } }
        
        .status-msg { font-size: 10px; padding: 10px; border: 2px solid currentColor; margin-bottom: 10px; font-weight: bold; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const firebaseConfig = {
            apiKey: "AIzaSyB9HsfmW3iNinFZD85XxMW9Om6valo3Nf8",
            authDomain: "smiling-ziwei.firebaseapp.com",
            projectId: "smiling-ziwei",
            storageBucket: "smiling-ziwei.firebasestorage.app",
            messagingSenderId: "447037749434",
            appId: "1:447037749434:web:b3827105adac2ecfb22a83"
        };
        
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const appId = "smiling-ziwei-official";

        const Icon = ({ name, size = 20, className = "" }) => {
            useEffect(() => { if(window.lucide) lucide.createIcons(); }, []);
            return <i data-lucide={name} style={{ width: size, height: size }} className={className}></i>;
        };

        const RunningCat = () => (
            <div className="cat-run">
                <svg width="40" height="40" viewBox="0 0 16 16" fill="none">
                    <rect x="4" y="6" width="8" height="6" fill="#4a1d96" />
                    <rect x="10" y="3" width="5" height="5" fill="#4a1d96" />
                    <rect x="10" y="2" width="1" height="1" fill="#4a1d96" />
                    <rect x="14" y="2" width="1" height="1" fill="#4a1d96" />
                    <rect x="11" y="4" width="1" height="1" fill="white" />
                    <rect x="13" y="4" width="1" height="1" fill="white" />
                    <rect x="1" y="5" width="1" height="4" fill="#4a1d96" />
                    <g className="leg-move">
                        <rect x="5" y="12" width="2" height="2" fill="#4a1d96" />
                        <rect x="10" y="12" width="2" height="2" fill="#4a1d96" />
                    </g>
                </svg>
            </div>
        );

        const App = () => {
            const [user, setUser] = useState(null);
            const [isAdmin, setIsAdmin] = useState(false);
            const [isAuth, setIsAuth] = useState(false);
            const [pass, setPass] = useState("");
            const [bookings, setBookings] = useState([]);
            const [loading, setLoading] = useState(false);
            const [success, setSuccess] = useState(false);
            const [status, setStatus] = useState("æ­£åœ¨å˜—è©¦é€£ç·š...");
            
            const [form, setForm] = useState({ 
                nickname: '', gender: 'å¥³', birthDate: '', 
                birthTime: 'å­æ™‚ (23:00-01:00)', service: 'å‘½ç›¤è§£æ', notes: '' 
            });

            const LINE_ID = "147twhth";
            const IG_URL = "https://www.instagram.com/mimichen0130/";

            const services = [
                { title: "å‘½ç›¤è§£æ", price: "2,000", time: "60 åˆ†é˜", desc: "å®Œæ•´æ€§æ ¼ã€åå¹´å¤§é™ã€æµå¹´è¦åŠƒã€‚è¦åŠƒæœªä¾†é¦–é¸ï¼", icon: "user" },
                { title: "æµå¹´é‹å‹¢", price: "1,000", time: "30 åˆ†é˜", desc: "è§£æå¹´åº¦é‡é»åŠæ³¨æ„æœˆä»½å‰å‡¶æŒæ¡ã€‚", icon: "calendar" },
                { title: "å–®é¡Œå•äº‹", price: "600", time: "30 åˆ†é˜", desc: "é‡å°ç‰¹å®šé›£é¡Œæä¾›è§£ç­”ã€‚", icon: "help-circle" },
                { title: "ç´«å¾®ç‰Œå¡", price: "500", time: "15 åˆ†é˜", desc: "é©åˆè™•ç†ç•¶å‰æŠ‰æ“‡ã€‚", icon: "dices" }
            ];

            useEffect(() => {
                auth.signInAnonymously()
                    .then(() => setStatus("âœ… ä¼ºæœå™¨å·²é€£ç·š"))
                    .catch(e => setStatus("âŒ é€£ç·šå¤±æ•—ï¼š" + e.message));
                return auth.onAuthStateChanged(u => setUser(u));
            }, []);

            useEffect(() => {
                let unsubscribe;
                if (user && isAdmin && isAuth) {
                    setLoading(true);
                    setStatus("æ­£åœ¨æŠ“å–é ç´„è³‡æ–™...");
                    
                    const colRef = db.collection('artifacts').doc(appId).collection('public').doc('data').collection('bookings');
                    
                    unsubscribe = colRef.onSnapshot(snapshot => {
                        const data = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                        setBookings(data.sort((a,b) => (b.createdAt?.seconds || 0) - (a.createdAt?.seconds || 0)));
                        setLoading(false);
                        setStatus("âœ… è³‡æ–™åŒæ­¥ä¸­ (å…± " + data.length + " ç­†)");
                    }, err => {
                        setStatus("âŒ è®€å–å¤±æ•—ï¼šæ¬Šé™è¢«æ‹’çµ•ã€‚è«‹æª¢æŸ¥ Firebase Rules è¨­å®šã€‚");
                        setLoading(false);
                    });
                }
                return () => unsubscribe && unsubscribe();
            }, [user, isAdmin, isAuth]);

            const submit = async (e) => {
                e.preventDefault();
                setLoading(true);
                try {
                    const colRef = db.collection('artifacts').doc(appId).collection('public').doc('data').collection('bookings');
                    await colRef.add({
                        ...form,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        status: 'æœªè™•ç†'
                    });
                    setSuccess(true);
                    window.scrollTo(0, 0);
                } catch(e) { 
                    setStatus("âŒ æäº¤å¤±æ•—ï¼š" + e.message); 
                }
                setLoading(false);
            };

            return (
                <div className="min-h-screen flex flex-col">
                    <RunningCat />
                    <nav className="fixed top-0 w-full bg-[#f7d7ff] border-b-4 border-purple-900 z-50 p-4 flex justify-between items-center shadow-md">
                        <div className="flex items-center gap-2 font-bold text-purple-900">
                            <Icon name="sparkles" />
                            <span className="text-sm">SMILING ZIWEI</span>
                        </div>
                        <button onClick={() => { setIsAdmin(!isAdmin); setIsAuth(false); setSuccess(false); }} className="text-[10px] underline font-bold uppercase">
                            {isAdmin ? 'Back / é¦–é ' : 'Admin / å¾Œå°'}
                        </button>
                    </nav>

                    <main className="pt-24 px-6 max-w-xl mx-auto grid-bg flex-grow pb-24 w-full">
                        {/* ç‹€æ…‹åˆ— (åƒ… Admin æ¨¡å¼ä¸‹æ˜é¡¯) */}
                        {isAdmin && (
                            <div className={`status-msg ${status.includes('âŒ') ? 'bg-red-50 text-red-600' : 'bg-green-50 text-green-600'}`}>
                                {status}
                            </div>
                        )}

                        {isAdmin ? (
                            !isAuth ? (
                                <div className="pixel-card p-10 text-center bg-white mt-10">
                                    <Icon name="lock" size={40} className="mx-auto mb-6 text-purple-900" />
                                    <h2 className="text-[10px] font-bold mb-8 uppercase tracking-widest">Admin Access</h2>
                                    <form onSubmit={(e) => { e.preventDefault(); if(pass === "8888") setIsAuth(true); else setStatus("âŒ å¯†ç¢¼éŒ¯èª¤ï¼"); }}>
                                        <input type="password" placeholder="PASSWORD" className="w-full p-3 border-2 border-black text-center font-bold mb-6 outline-none" onChange={e => setPass(e.target.value)} autoFocus />
                                        <button type="submit" className="pixel-btn w-full bg-purple-900 text-white p-4 font-bold uppercase shadow-lg">Login</button>
                                    </form>
                                </div>
                            ) : (
                                <div className="space-y-4 animate-in fade-in">
                                    <div className="flex justify-between items-center border-b-4 border-purple-900 pb-4 font-bold text-[10px] uppercase">
                                        <h2>Bookings List ({bookings.length})</h2>
                                        <button onClick={()=>setIsAuth(false)} className="bg-black text-white text-[8px] px-2 py-1 font-bold">LOGOUT</button>
                                    </div>
                                    {bookings.length === 0 && !loading && (
                                        <div className="text-center py-20 opacity-30 text-xs font-bold uppercase italic tracking-widest bg-white pixel-card">ç›®å‰å°šç„¡é ç´„è³‡æ–™ã€‚</div>
                                    )}
                                    {bookings.map(b => (
                                        <div key={b.id} className="pixel-card p-4 text-[10px] font-bold bg-white mb-4">
                                            <div className="flex justify-between mb-2">
                                                <span className="text-purple-900 uppercase font-bold text-xs">{b.nickname} ({b.gender})</span>
                                                <span className="text-pink-600 border border-pink-200 px-1 bg-pink-50">{b.service}</span>
                                            </div>
                                            <div className="space-y-1 opacity-70 mt-2 font-bold">
                                                <p>åœ‹æ›†ç”Ÿæ—¥ï¼š{b.birthDate} ({b.birthTime})</p>
                                                {b.notes && <p className="mt-2 bg-slate-50 p-2 border-l-2 border-purple-200 italic font-normal text-slate-600">å‚™è¨»ï¼š"{b.notes}"</p>}
                                            </div>
                                            <div className="mt-4 flex justify-end">
                                                <button onClick={() => confirm('ç¢ºå®šåˆªé™¤ï¼Ÿ') && db.collection('artifacts').doc(appId).collection('public').doc('data').collection('bookings').doc(b.id).delete()} className="text-red-500 underline uppercase text-[8px]">Delete</button>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )
                        ) : (
                            <div className="space-y-8">
                                <div className="pixel-card p-8 text-center bg-white shadow-xl relative overflow-hidden">
                                    <h1 className="text-lg md:text-xl text-purple-900 font-bold uppercase mb-4 tracking-tighter leading-tight">ç¬‘ç‡ç‡ç´«å¾®æ–—æ•¸<br/><span className="text-pink-600 text-sm">äººé¡ä¸–ç•Œæ”»ç•¥å°é­”æ³•</span></h1>
                                    <p className="text-[11px] leading-relaxed mb-6 font-bold text-slate-600 uppercase tracking-tighter">æ‹¿å›äººç”Ÿä¸»å°æ¬Šã€‚ç´«å¾®æ–—æ•¸æ˜¯ä¸€ä»½ã€Œäººç”Ÿåœ°åœ–ã€ï¼Œå¹«åŠ©ä½ å„ªé›…é€šé—œã€‚</p>
                                    <div className="flex justify-center gap-4">
                                        <button onClick={() => document.getElementById('booking-form').scrollIntoView({behavior: 'smooth'})} className="pixel-btn bg-pink-500 text-white px-4 py-2 text-[10px] font-bold">ç«‹åˆ»é ç´„</button>
                                        <button onClick={() => window.open(`https://line.me/R/ti/p/@${LINE_ID}`)} className="pixel-btn bg-white px-4 py-2 text-[10px] font-bold">LINE è«®è©¢</button>
                                    </div>
                                </div>

                                <div className="space-y-4">
                                    <h2 className="text-[10px] text-purple-900 font-bold border-b-4 border-purple-900 pb-1 uppercase tracking-widest text-center">Services / è«®è©¢é …ç›®</h2>
                                    {services.map((s, idx) => (
                                        <div key={idx} className="pixel-card p-5 bg-white">
                                            <div className="flex items-center gap-3 mb-2">
                                                <div className="w-10 h-10 bg-purple-50 flex items-center justify-center border-2 border-purple-900">
                                                    <Icon name={s.icon} className="text-purple-900" />
                                                </div>
                                                <div>
                                                    <h3 className="text-xs font-bold text-purple-900">{s.title}</h3>
                                                    <div className="flex gap-2 items-center text-[9px] font-bold">
                                                        <span className="text-pink-600 underline uppercase tracking-widest">NT$ {s.price}</span>
                                                        <span className="bg-slate-100 px-1 border border-slate-200 text-slate-400">æ™‚é•·: {s.time}</span>
                                                    </div>
                                                </div>
                                            </div>
                                            <p className="text-[10px] font-bold text-slate-500 leading-relaxed mt-2">{s.desc}</p>
                                        </div>
                                    ))}
                                </div>

                                <div id="booking-form">
                                    {!success ? (
                                        <form onSubmit={submit} className="pixel-card p-6 space-y-6 bg-white shadow-lg animate-in slide-in-from-bottom-4">
                                            <div className="text-center border-b-2 border-dashed border-purple-100 pb-4 font-bold text-xs uppercase text-purple-900 tracking-widest">Registration</div>
                                            <div className="space-y-5 text-[10px] font-bold uppercase">
                                                <div>
                                                    <label className="block text-purple-900 mb-1">æš±ç¨± / Nickname</label>
                                                    <input required className="w-full p-3 border-2 border-black focus:bg-pink-50 outline-none font-bold" onChange={e => setForm({...form, nickname: e.target.value})} />
                                                </div>
                                                <div>
                                                    <label className="block text-purple-900 mb-1">è«®è©¢é …ç›® / Service</label>
                                                    <select className="w-full p-3 border-2 border-black bg-white outline-none font-bold" onChange={e => setForm({...form, service: e.target.value})}>
                                                        {services.map(s => <option key={s.title}>{s.title} ({s.time})</option>)}
                                                    </select>
                                                </div>
                                                <div className="grid grid-cols-2 gap-4">
                                                    <input required type="date" className="w-full p-3 border-2 border-black outline-none font-bold" onChange={e => setForm({...form, birthDate: e.target.value})} />
                                                    <select className="w-full p-3 border-2 border-black bg-white outline-none font-bold text-[9px]" onChange={e => setForm({...form, birthTime: e.target.value})}>
                                                        <option>å­ (23-01)</option><option>ä¸‘ (01-03)</option><option>å¯… (03-05)</option>
                                                        <option>å¯ (05-07)</option><option>è¾° (07-09)</option><option>å·³ (09-11)</option>
                                                        <option>åˆ (11-13)</option><option>æœª (13-15)</option><option>ç”³ (15-17)</option>
                                                        <option>é…‰ (17-19)</option><option>æˆŒ (19-21)</option><option>äº¥ (21-23)</option>
                                                    </select>
                                                </div>
                                                <div>
                                                    <label className="block text-purple-900 mb-1">å‚™è¨» / Note</label>
                                                    <textarea placeholder="ç›®å‰çš„ç…©æƒ±..." className="w-full p-3 border-2 border-black outline-none h-24 focus:bg-pink-50 resize-none font-bold shadow-inner" onChange={e => setForm({...form, notes: e.target.value})} />
                                                </div>
                                            </div>
                                            <button type="submit" disabled={loading} className="pixel-btn w-full bg-pink-500 text-white p-5 font-bold shadow-lg tracking-widest text-xs uppercase">
                                                {loading ? 'SENDING...' : 'START QUEST / ç¢ºèªé ç´„'}
                                            </button>
                                        </form>
                                    ) : (
                                        <div className="pixel-card p-12 text-center bg-white space-y-8 shadow-xl animate-in zoom-in-95">
                                            <Icon name="check-circle" size={64} className="mx-auto text-green-500" />
                                            <h2 className="text-lg text-purple-900 font-bold uppercase tracking-tighter">Mission Clear!</h2>
                                            <p className="text-[11px] font-bold text-slate-500 leading-relaxed uppercase">é ç´„å·²æˆåŠŸã€‚è«‹å‰å¾€ LINE è¯ç¹«è€å¸«ç¢ºèªæ™‚é–“ã€‚</p>
                                            <button onClick={() => window.open(`https://line.me/R/ti/p/@${LINE_ID}`)} className="pixel-btn bg-[#06c755] text-white p-5 w-full font-bold shadow-lg text-xs uppercase tracking-widest">å‰å¾€ LINE è¯ç¹«</button>
                                            <button onClick={() => setSuccess(false)} className="text-[10px] underline opacity-30 block mx-auto font-bold mt-4 uppercase tracking-tighter">BACK / è¿”å›</button>
                                        </div>
                                    )}
                                </div>
                            </div>
                        )}
                    </main>

                    <footer className="py-12 text-center bg-white border-t-4 border-purple-900 mt-auto">
                        <div className="flex justify-center gap-10 mb-8">
                            <a href={IG_URL} target="_blank" className="flex flex-col items-center gap-2 hover:translate-y-[-4px] transition-transform text-purple-900 hover:text-pink-600 group">
                                <div className="w-12 h-12 border-4 border-current flex items-center justify-center bg-white group-hover:bg-pink-50">
                                    <Icon name="instagram" size={24} />
                                </div>
                                <span className="text-[8px] font-bold tracking-widest uppercase">IG / @mimichen0130</span>
                            </a>
                            <a href={`https://line.me/R/ti/p/@${LINE_ID}`} target="_blank" className="flex flex-col items-center gap-2 hover:translate-y-[-4px] transition-transform text-purple-900 hover:text-green-600 group">
                                <div className="w-12 h-12 border-4 border-current flex items-center justify-center bg-white group-hover:bg-green-50">
                                    <Icon name="message-circle" size={24} />
                                </div>
                                <span className="text-[8px] font-bold tracking-widest uppercase">LINE / OFFICE</span>
                            </a>
                        </div>
                        <p className="opacity-30 text-[8px] font-bold uppercase tracking-[0.3em]">Â© 2026 SMILING ZIWEI STUDIO | UPGRADE YOUR SOUL</p>
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>

